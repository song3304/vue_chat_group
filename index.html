<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>直播间</title>
  </head>
  <body>

  <script>
    var match_hall_catalogs=[{"id":18,"name":"\u4e59\u4e8c\u91871809","status":1,"grade_no":null,"catalog_id":11,"catalog_path":"2,9,11","porder":0,"delivery_start":"2018-09-15","delivery_end":"2018-09-25","create_time":"2018-06-29 17:43:40","update_time":"2018-06-29 17:44:13","delete_time":null,"show":1},{"id":19,"name":"\u4e59\u4e8c\u91871810","status":1,"grade_no":null,"catalog_id":11,"catalog_path":"2,9,11","porder":0,"delivery_start":"2018-10-15","delivery_end":"2018-10-25","create_time":"2018-08-13 11:42:42","update_time":"2018-08-13 11:42:42","delete_time":null,"show":0},{"id":20,"name":"\u4e59\u4e8c\u91871811","status":1,"grade_no":null,"catalog_id":11,"catalog_path":"2,9,11","porder":0,"delivery_start":"2018-11-15","delivery_end":"2018-11-25","create_time":"2018-09-03 10:10:36","update_time":"2018-09-03 10:11:15","delete_time":null,"show":0}];
    var match_hall_cms=[{"id":2802,"title":"\u516c\u5bd3\u5e02\u573a\u672a\u6765\u524d\u666f\u5982\u4f55?","create_time":"2018-06-28 14:06:52","time":"06-28"},{"id":2801,"title":"\u516c\u5bd3\u5e02\u573a\u672a\u6765\u524d\u666f\u5982\u4f55?","create_time":"2018-06-28 14:06:07","time":"06-28"},{"id":2800,"title":"\u516c\u5bd3\u5e02\u573a\u672a\u6765\u524d\u666f\u5982\u4f55?\u6052\u5927\u3001\u4e50\u5c45\u7b49\u5730\u4ea7\u5927\u5496\u5206\u4eab\u5e72\u8d27","create_time":"2018-06-28 14:05:15","time":"06-28"},{"id":2799,"title":"\u6052\u5927\u5730\u4ea727.47\u4ebf\u62a2\u53604\u5b97\u5730 \u62ff\u5730550.68\u4ea9","create_time":"2018-06-28 14:04:14","time":"06-28"},{"id":2798,"title":"\u5929\u6d25\u653e\u5bbd\u843d\u6237\u6761\u4ef6\u00a01\u5929\u5438\u5f1530\u4e07\u4eba","create_time":"2018-06-28 14:03:25","time":"06-28"},{"id":2795,"title":"\u4e59\u4e8c\u9187\uff1a\u53cd\u5f39\u6619\u82b1\u4e00\u73b0 \u884c\u60c5\u5f31\u52bf\u96be\u6539","create_time":"2018-05-14 09:56:13","time":"05-14"},{"id":2794,"title":"\u84ec\u4f69\u5965\u79f0\u5982\u671d\u9c9c\u8fc5\u901f\u5f03\u6838\u7f8e\u5c06\u52a9\u5176\u7e41\u8363","create_time":"2018-05-14 09:55:07","time":"05-14"},{"id":2793,"title":"\u76db\u6cfd\u5609\u5174\u4e24\u5730\u8f7b\u7eba\u539f\u6599\u5e02\u573a\u4e00\u5468\uff085.7-5.13\uff09\u884c\u60c5","create_time":"2018-05-14 09:47:13","time":"05-14"},{"id":2792,"title":"\u7f8e\u6cb9\u8fde\u6da8\u4e24\u5468 \u5e03\u6cb9\u4e00\u5468\u4ee5\u6765\u52b2\u53473%","create_time":"2018-05-14 09:45:33","time":"05-14"},{"id":2791,"title":"\u6d59\u6c5f\u5916\u8d38\u4f01\u4e1a\u5927\u8f6c\u578b\uff1a\u6dd8\u5de5\u5382\u4e0e\u65b0\u4f9b\u5e94\u94fe\u63a2\u7d22","create_time":"2018-05-14 09:45:12","time":"05-14"}];
    var match_hall_companies=[{"id":32,"name":"\u5316\u5851\u6c47","shortName":"\u5316\u5851\u6c47","pic_url":"\/upload\/2018\/03\/05\/5a3b949e90d5204d3dace23be7233ca0.png","members":[{"id":53,"username":"huasuhui","password":"3b8fdb64bd33aec3da78ce440d521cc5","nickname":"\u5316\u5851\u6c47","realname":"huasuhui","phone":"15234060911","is_phone_show":1,"email":"1150227205@qq.com","gender":1,"pic_url":"\/upload\/2018\/08\/31\/8e79c186acfccb4748a57e22a5741b49.png","org_id":32,"system_type":2,"is_valid":1,"qq":"3280442307","profile":"\u5316\u5851\u6c47\u7ba1\u7406\u5458","create_time":"2018-01-16 17:12:29","update_time":"2018-08-31 15:51:30","delete_time":null},{"id":67,"username":"xiaowang","password":"eeba91b2b2d15fdd456edf8f9594448f","nickname":"\u5316\u5851\u6c47-\u5c0f\u738b","realname":"\u5316\u5851\u6c47-\u5c0f\u738b","phone":"18800000294","is_phone_show":0,"email":"4343432@qq.com","gender":1,"pic_url":"\/upload\/2018\/08\/30\/b5a0d45c515b8d22eb8d9a7807ed3695.png","org_id":32,"system_type":2,"is_valid":1,"qq":"18800000294","profile":"\u5c0f\u738b","create_time":"2018-01-25 17:23:20","update_time":"2018-09-03 16:59:49","delete_time":null},{"id":68,"username":"xiaoli","password":"eeba91b2b2d15fdd456edf8f9594448f","nickname":"\u5c0f\u674e","realname":"xiaoli","phone":"18710123455","is_phone_show":1,"email":"538636@qq.com","gender":1,"pic_url":"\/upload\/2018\/05\/30\/cf7160454535470598c2725113b859df.png","org_id":32,"system_type":2,"is_valid":1,"qq":"18710123455","profile":"\u5c0f\u674e","create_time":"2018-01-25 17:25:32","update_time":"2018-07-10 15:49:20","delete_time":null},{"id":69,"username":"xiaozhang","password":"eeba91b2b2d15fdd456edf8f9594448f","nickname":"\u5316\u5851\u6c47-\u5c0f\u5f20","realname":"\u5316\u5851\u6c47-\u5c0f\u5f20","phone":"13901031183","is_phone_show":1,"email":"4345345345@qq.com","gender":1,"pic_url":"\/upload\/2018\/06\/29\/6b8f8988c6feebaca095ba483a91c74c.bmp","org_id":32,"system_type":2,"is_valid":1,"qq":"2467014700","profile":"\u5c0f\u5f20","create_time":"2018-01-25 17:27:06","update_time":"2018-06-29 10:58:51","delete_time":null}]},{"id":42,"name":"\u5316\u5546\u901a","shortName":"\u5316\u5546\u901a","pic_url":"\/upload\/2018\/03\/21\/8f00cc24055535f70a120fc6e37a66a4.png","members":[{"id":72,"username":"huashangtong","password":"0b11d4799d31fd4b6b3eeb8a3f82f086","nickname":"\u5171\u8d62","realname":"\u674e\u5e7f\u6000","phone":"17521091706","is_phone_show":1,"email":"115022725505@qq.com","gender":0,"pic_url":"\/upload\/2018\/05\/25\/c1a33aa432740914d197709a397a1cdb.png","org_id":42,"system_type":2,"is_valid":1,"qq":"3280442307","profile":"\u5316\u5546\u901a\u7ba1\u7406\u5458","create_time":"2018-01-29 18:13:33","update_time":"2018-09-01 18:39:35","delete_time":null},{"id":92,"username":"test01","password":"eeba91b2b2d15fdd456edf8f9594448f","nickname":"test01","realname":"test01","phone":"15705240033","is_phone_show":1,"email":"524156@qq.com","gender":1,"pic_url":"\/upload\/2018\/08\/30\/c40bf3d04ee07f57bff19fc4d9e65a5b.jpg","org_id":42,"system_type":2,"is_valid":1,"qq":"323","profile":"sdgdf ","create_time":"2018-08-30 14:43:09","update_time":"2018-08-30 14:43:09","delete_time":null}]},{"id":44,"name":"\u4e0a\u6d77\u54f2\u8bdd\u6295\u8d44\u7ba1\u7406\u6709\u9650\u516c\u53f8\t","shortName":"\u54f2\u8bdd","pic_url":"\/static\/images\/default.png","members":[{"id":80,"username":"zhehua","password":"52851e30a214736e6eb9233d3b9ad3a6","nickname":"\u54f2\u8bdd","realname":"\u54f2\u8bdd\u8272\u653e","phone":"13916597115","is_phone_show":1,"email":"12123324031292@qq.com","gender":2,"pic_url":"\/static\/images\/default.png","org_id":44,"system_type":2,"is_valid":1,"qq":"13916697115","profile":"\u54f2\u8bdd\u7ba1\u7406\u5458","create_time":"2018-04-17 18:22:59","update_time":"2018-05-23 14:44:38","delete_time":null}]},{"id":45,"name":"\u676d\u5dde\u5fe0\u6734\u6295\u8d44\u54a8\u8be2\u6709\u9650\u516c\u53f8","shortName":"\u5fe0\u6734","pic_url":"\/static\/images\/default.png","members":[{"id":81,"username":"zhongputouzi","password":"e4eb77bb0fc2ad0b34ca5b24bc712cf9","nickname":"zhongputouzi","realname":"zhongputouzi","phone":"18301302257","is_phone_show":1,"email":null,"gender":0,"pic_url":"\/static\/images\/default.png","org_id":45,"system_type":2,"is_valid":1,"qq":null,"profile":null,"create_time":"2018-04-25 11:09:11","update_time":"2018-04-25 11:09:11","delete_time":null}]}];
    var _chat_user = {"id":53,"name":"\u5316\u5851\u6c47","img":"2018\/08\/31\/8e79c186acfccb4748a57e22a5741b49.png","system_type":2,"org_id":32,"company_name":"\u5316\u5851\u6c47","trade_type":"","company_short_name":"\u5316\u5851\u6c47"};
    var _chat_hall_members = [{"id":53,"img":"\/upload\/2018\/08\/31\/8e79c186acfccb4748a57e22a5741b49.png","name":"\u5316\u5851\u6c47","phone":"15234060911","org_id":32,"plat":"match","trade_type":"","company_name":"\u5316\u5851\u6c47","company_short_name":"\u5316\u5851\u6c47"},{"id":54,"img":"\/upload\/2018\/05\/31\/94a01cd8ca2415968f92a190b8a32641.png","name":"dongfanghuasu","phone":"13800138001","org_id":33,"plat":"trade","trade_type":"trade","company_name":"\u4e1c\u65b9\u534e\u5851","company_short_name":"\u4e1c\u65b9"},{"id":67,"img":"\/upload\/2018\/08\/30\/b5a0d45c515b8d22eb8d9a7807ed3695.png","name":"\u5316\u5851\u6c47-\u5c0f\u738b","phone":"18800000294","org_id":32,"plat":"match","trade_type":"","company_name":"\u5316\u5851\u6c47","company_short_name":"\u5316\u5851\u6c47"},{"id":68,"img":"\/upload\/2018\/05\/30\/cf7160454535470598c2725113b859df.png","name":"\u5c0f\u674e","phone":"18710123455","org_id":32,"plat":"match","trade_type":"","company_name":"\u5316\u5851\u6c47","company_short_name":"\u5316\u5851\u6c47"},{"id":69,"img":"\/upload\/2018\/06\/29\/6b8f8988c6feebaca095ba483a91c74c.bmp","name":"\u5316\u5851\u6c47-\u5c0f\u5f20","phone":"13901031183","org_id":32,"plat":"match","trade_type":"","company_name":"\u5316\u5851\u6c47","company_short_name":"\u5316\u5851\u6c47"},{"id":70,"img":"\/static\/images\/default.png","name":"\u4e1c\u65b9\u534e\u5851","phone":"13430781623","org_id":33,"plat":"trade","trade_type":"trade","company_name":"\u4e1c\u65b9\u534e\u5851","company_short_name":"\u4e1c\u65b9"},{"id":72,"img":"\/upload\/2018\/05\/25\/c1a33aa432740914d197709a397a1cdb.png","name":"\u5171\u8d62","phone":"17521091706","org_id":42,"plat":"match","trade_type":"","company_name":"\u5316\u5546\u901a","company_short_name":"\u5316\u5546\u901a"},{"id":80,"img":"\/static\/images\/default.png","name":"\u54f2\u8bdd","phone":"13916597115","org_id":44,"plat":"match","trade_type":"","company_name":"\u4e0a\u6d77\u54f2\u8bdd\u6295\u8d44\u7ba1\u7406\u6709\u9650\u516c\u53f8\t","company_short_name":"\u54f2\u8bdd"},{"id":81,"img":"\/static\/images\/default.png","name":"zhongputouzi","phone":"18301302257","org_id":45,"plat":"match","trade_type":"","company_name":"\u676d\u5dde\u5fe0\u6734\u6295\u8d44\u54a8\u8be2\u6709\u9650\u516c\u53f8","company_short_name":"\u5fe0\u6734"},{"id":91,"img":"\/upload\/2018\/08\/30\/8d8b95a14d5ec18d576939be28eb0359.png","name":"huashangtong","phone":"17621657056","org_id":48,"plat":"trade","trade_type":"trade","company_name":"\u6211\u662f\u4ea4\u6613\u5546","company_short_name":null},{"id":92,"img":"\/upload\/2018\/08\/30\/c40bf3d04ee07f57bff19fc4d9e65a5b.jpg","name":"test01","phone":"15705240033","org_id":42,"plat":"match","trade_type":"","company_name":"\u5316\u5546\u901a","company_short_name":"\u5316\u5546\u901a"}];
  </script>



  <!----实时报价 start---->
  <link href="http://www.energy.cn/static/css/vue_chat_group_hall.css" rel="stylesheet">
  <link href="http://www.energy.cn/static/css/index/front.css" rel="stylesheet">
  <link href="http://www.energy.cn/static/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="http://www.energy.cn/static/css/match/quick.css" rel="stylesheet">

  <script src="http://www.energy.cn/static/js/socket_chat_group.js"></script>
  <script src="http://www.energy.cn/static/js/match/jquery-1.11.0.min.js"></script>
  <script src="http://www.energy.cn/static/js/match/jquery-ui-1.10.4.min.js"></script>
  <script src="http://www.energy.cn/static/js/custom.js"></script>
  <script src="http://www.energy.cn/static/js/socket.io.1.3.7/socket.io.js"></script>
  <script src="http://www.energy.cn/static/js/echarts.min.js"></script>
  <script src="http://www.energy.cn/static/js/showK.js"></script>
  <script src="http://www.energy.cn/static/js/vue_chat_group_hall.js"></script>
  <script src="http://www.energy.cn/static/js/socket_chat_group.js"></script>
  <script type="text/javascript">
      !function($){
          var echartsObj = [], panObj = [],panObj1 = [];
          var ninestamp=this.ninestamp();
          var resizeChart=function(){
						$=jQuery;
				        var param=(document.body.clientWidth<1340)?0.7:0.7;
				        var realWidth=$("#myTabContent").width();
				        for(var i=0;i<echartsObj.length;i++){
				            panObj[i].width(realWidth*param-31);
				            echartsObj[i].myDataChart.resize();
				        }
				        $price_list = $('.price-list');
				        if(document.body.clientWidth>1340) {
				        	$('.price-list').width(realWidth*0.3-30);
				        	$('#trend').css('height','408px').css('background','#ffffff');
				        }else{
				        	$price_list.width(realWidth*0.3-30).css("margin-left", "0").css("margin-top", "5px");
				        	$('#trend').css('height','780px').css('background','#ffffff');
				        }
				 	};
          document.ready = function() {
              var uid=0;
              // 连接服务端
              var socket = io(quoteAddress[0]);
              var socket_id = socket.id;
              var chartArr=new Array();
              if (match_hall_catalogs.length!=0) {
                  $.each(match_hall_catalogs, function (index, item) {
                      var product_id = item.id;
                      var chartName="myChart_"+item.id;
                      chartArr[chartName]= new MyChart(product_id, uid, ninestamp);
                      var realWidth = $("#myTabContent").width();
                      $('#pan_data_' + product_id).width(realWidth * 0.7 - 31);
                       $('.price-list').width(realWidth*0.3-30);
                      echartsObj.push(chartArr[chartName]);
                      panObj.push($('#pan_data_' + product_id));
                      chartArr[chartName].init('pan_data_' + product_id, 'bird_price_banner_' + product_id, 5);
                  });
              }
              resizeChart();
              // 连接后登录
              var first_connected = false;
              socket.on('connect', function(){
                  if (!first_connected) {
                      first_connected = true;
                      socket_id = socket.id;
                  }
                  socket.emit('login', uid);
                  $.each(match_hall_catalogs,function(index,item){
                      if (socket_id != socket.id) {
                          //重新连接，则重新加载初始化数据
                          //eval("myChart_"+item.id).initialize();
                          chartArr["myChart_"+item.id].initialize();
                      }
                  });
                  socket_id = socket.id;
              });

              socket.on('login_success', function(msg){
                  $.each(match_hall_catalogs,function(index,item){
                      socket.emit('register', uid, item.id,uid);
                  });
              });



              // 后端推送来消息时
              socket.on('quoteUpdate', function(data){
                  var formatData=JSON.parse(data);
                  if (formatData.code === 0) {
                      mychart = chartArr["myChart_"+formatData.product_id];
                  } else {
                      return;
                  }
                  if (formatData.data.sell_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.sell_average,
                          PriceType.Sell);
                  }
                  if (formatData.data.buy_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.buy_average,
                          PriceType.Buy);
                  }
                  if (formatData.data.order_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.order_average,
                          PriceType.Order);
                  }
                  if (formatData.data.sell_open_price !== undefined) {

                      mychart.offerStore.sell_begin_price=formatData.data.sell_open_price;
                  }
                  if (formatData.data.buy_open_price !== undefined) {
                      mychart.offerStore.buy_begin_price=formatData.data.buy_open_price;
                  }
                  mychart.refreshChart();
                  //处理报价信息
                  mychart.OfferBird.init(formatData.data);
                  mychart.OfferBird.render();
                  $.each(match_hall_catalogs,function(index,item){
                      if(formatData.product_id==item.id){
                          mychart.init_dync_price('realtime_'+item.id);
                          mychart.OfferBird.renderDync();
                      }
                  });
              });
						window.onresize = function () {
						    resizeChart();
						};
          }
      }(jQuery);

          function ninestamp() {
              var timeModel=new Date();
              timeModel.setHours('09',0,0,0);
              return timeModel.getTime()/1000;
          }

      function refresh(select_product_id,select_user_id,select_company_id) {
          !function ($) {
              var newChartObj = [], newPanObj = [];
              var ninestamp = this.ninestamp();
              // 连接服务端
              var old_socket = io(quoteAddress[0]);
              old_socket.removeAllListeners().disconnect();
              var socket = io(quoteAddress[0]);
              socket.connect();
              socket_id = socket.id;
              var chartArray = new Array();
              if (match_hall_catalogs.length != 0) {
                  var newChartName = "myChart_" + select_product_id;
                  if (select_company_id != undefined && select_company_id != '' && select_user_id == 0) {
                      chartArray[newChartName] = new MyChart(select_product_id, select_user_id, ninestamp, select_company_id);
                  } else {
                      chartArray[newChartName] = new MyChart(select_product_id, select_user_id, ninestamp);
                  }
                  var realWidth = $("#myTabContent").width();
                  $('#pan_data_' + select_product_id).width(realWidth * 0.7 - 31);
                   $('.price-list').width(realWidth*0.3-30);
                  newChartObj.push(chartArray[newChartName]);
                  newPanObj.push($('#pan_data_' + select_product_id));
                  chartArray[newChartName].init('pan_data_' + select_product_id, 'bird_price_banner_' + select_product_id, 5);
              }
              // 连接后登录
              var first_connected = false;
              socket.on('connect', function () {
                  if (!first_connected) {
                      first_connected = true;
                      socket_id = socket.id;
                  }
                  socket.emit('login', select_user_id);
                  if (socket_id != socket.id) {
                      chartArray["myChart_" + select_product_id].initialize();
                  }
                  socket_id = socket.id;
              });
              socket.on('login_success', function (msg) {
                  if (select_company_id != undefined && select_company_id != '' && select_user_id == 0) {
                      socket.emit('register', select_user_id, select_product_id, select_user_id, select_company_id);
                  } else {
                      socket.emit('register', select_user_id, select_product_id, select_user_id);
                  }
              });
              // 后端推送来消息时
              socket.on('quoteUpdate', function (data) {
                  var formatData = JSON.parse(data);
                  if (formatData.code === 0) {
                      mychart = chartArray["myChart_" + formatData.product_id];
                  } else {
                      return;
                  }
                  if (formatData.data.sell_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.sell_average, PriceType.Sell);
                  }
                  if (formatData.data.buy_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.buy_average, PriceType.Buy);
                  }
                  if (formatData.data.order_average !== undefined) {
                      mychart.offerStore.addPrice(formatData.data.order_average, PriceType.Order);
                  }
                  if (formatData.data.sell_open_price !== undefined) {
                      mychart.offerStore.sell_begin_price = formatData.data.sell_open_price;
                  }
                  if (formatData.data.buy_open_price !== undefined) {
                      mychart.offerStore.buy_begin_price = formatData.data.buy_open_price;
                  }
                  mychart.refreshChart();
                  //处理报价信息
                  mychart.OfferBird.init(formatData.data);
                  mychart.init_dync_price('realtime_' + select_product_id);
                  mychart.OfferBird.renderDync();
              });
          }(jQuery);
      }



  </script>
  <!----实时报价 end---->


    <div id="chat_app">

    </div>


  </body>
</html>
